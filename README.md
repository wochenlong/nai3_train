# âœ¨ nai3_train âœ¨

è‹±æ–‡ç‰ˆè¯´æ˜ï¼š[English Documentation](./README_EN.md)

å¦‚æœä½ éœ€è¦ä½¿ç”¨nai3ç”Ÿæˆçš„å›¾ç‰‡æ¥æ‰¹é‡è®­ç»ƒä½ çš„SDæ¨¡å‹ï¼Œé‚£æˆ‘æƒ³ä½ éœ€è¦è¿™ä¸ªé¡¹ç›®ã€‚

nai3ç”Ÿæˆçš„å›¾ç‰‡ï¼Œä¸€é”®ç”Ÿæˆã€æ‰“æ ‡å’Œå¤„ç†è„šæœ¬

åŸç†1ï¼šä»prompt_folderéšæœºæŠ½å–txtä½œä¸ºpromptæ‰¹é‡ç”Ÿæˆéšæœºç´ æ

æŠŠä½ çš„æ‰“æ ‡txtå˜æˆä½ çš„éšæœºæç¤ºè¯åº“ï¼

åŸç†2ï¼šä»jsonä¸­éšæœºæŠ½å–è§’è‰²ç”Ÿæˆéšæœºè§’è‰²ï¼Œæˆ–è€…æŒ‰é¡ºåºç”Ÿæˆæ‰€æœ‰è§’è‰²

å¤‡æ³¨ï¼šæ¬¢è¿æå‡ºæ–°åŠŸèƒ½ï¼Œè„šæœ¬è¿˜åœ¨ä¸æ–­ä¼˜åŒ–ä¸­

## ğŸ’¿ å®‰è£…è¿è¡Œç¯å¢ƒ

```bash
pip install pdm
# è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶é”å®šä¾èµ–ç‰ˆæœ¬
pdm install
```

## âš™ï¸ é…ç½®

> ä½¿ç”¨è®°äº‹æœ¬ç­‰æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€æœ¬ç›®å½•ä¸‹ `.env` æ–‡ä»¶, æ ¹æ®æ³¨é‡Šè¿›è¡Œä¸ªæ€§åŒ–é…ç½®, å…¶ä¸­ **token** æ˜¯å¿…éœ€çš„, å…¶å®ƒå‡å¯ä»¥ä¿æŒé»˜è®¤

token è·å–æ–¹æ³•:

- åœ¨ç½‘é¡µï¼ˆhttps://novelai.netï¼‰ ä¸­ç™»å½•ä½ çš„ NovelAI è´¦å·
- åœ¨å·¦ä¸Šè§’ä¸ªäººä¸­å¿ƒä¸­æ‰¾åˆ° â€œAccountâ€
- æ‰¾åˆ° â€œGet Persistent API Token.â€ æ ç›®
- ç‚¹å‡» â€œGenerate Tokenâ€ æŒ‰é’®ç”Ÿæˆ token

### âš ï¸ä¸€äº›å¸¸è§çš„æŠ¥é”™ï¼š

random_characetrs.pyä¿å­˜ç¬¬ä¸€ä¸ªå›¾åƒæ—¶æŠ¥é”™ï¼šå°bugï¼Œä¿å­˜ç¬¬ä¸€ä¸ªæ—¶å¿…å®šå¤±è´¥ï¼Œåé¢å°±æ­£å¸¸äº†

## âœ¨ æ”¯æŒçš„æ‰€æœ‰é‡‡æ ·å™¨åˆ—è¡¨

```
            "k_euler",
            "k_euler_ancestral",
            "k_dpmpp_2s_ancestral",
            "k_dpmpp_2m",
            "k_dpmpp_sde",
            "ddim_v3",
```

## âœ¨ ç”Ÿæˆçš„éšæœºè§’è‰²æ•ˆæœï¼š

å›¾ä¸€

![VA}S0W4AL6_ZIV~2 (BDX5](https://github.com/wochenlong/nai3_train/assets/117965575/6bfecd63-fa7f-4b36-bef9-1e8df2eef21f)

å›¾äºŒ

![0~O)3% YX{SRSL$2VY)PTJ](https://github.com/wochenlong/nai3_train/assets/117965575/093c08fc-bf83-4d38-a282-7470bf48e316)

å›¾ä¸‰ï¼š

![L_ZUGFLNWQXDY~4(A4~5XK2](https://github.com/wochenlong/nai3_train/assets/117965575/711aff18-3ef7-4390-889e-c0ffc846418e)

å›¾å››ï¼š
![V2L6B62X60RU7((XCBMAN 9](https://github.com/wochenlong/nai3_train/assets/117965575/7b290ae4-5d77-4210-9276-519bd8afe6d6)

## âœ¨ ç”Ÿæˆçš„éšæœºç´ ææ•ˆæœï¼š

å›¾å››ï¼š
![8R@KZV(13`(0U~25~KKQTR7](https://github.com/wochenlong/nai3_train/assets/117965575/1c5a42bf-b44e-48a6-aaab-aa5487554a42)

å›¾äº”ï¼š
![N9 KXF41KXXB2T~CKZ2VS`M](https://github.com/wochenlong/nai3_train/assets/117965575/37e1801f-bfea-4f7c-8701-ed4047c29a28)

## ğŸ¤— å¼€æºéšæœºæç¤ºè¯åº“

æµ·é‡txtéšæœºæç¤ºè¯ï¼Œè§£å‹åæ”¾è¿›`prompt_folder`å³å¯ã€‚

ä¸€ã€ 4Ké«˜è´¨é‡æç¤ºè¯åº“ ï¼šhttps://huggingface.co/datasets/windsingai/random_prompt/resolve/main/prompt_4k.zip

ç‰¹ç‚¹ï¼šäººå·¥æ•´ç†ï¼Œè‰¯å“ç‡é«˜ï¼Œå®‰å…¨æ€§é«˜ï¼Œåªæœ‰2%çš„nsfw

å†…å®¹ï¼šä»¥äººç‰©å’Œæ„å›¾ä¸ºä¸»

æ¥æºï¼šä¿®æ”¹è‡ªå°¤å‰çš„AIDè®­ç»ƒé›†çš„æ‰“æ ‡æ–‡ä»¶

äºŒã€ 20wé«˜è´¨é‡æç¤ºè¯åº“ ï¼šhttps://huggingface.co/datasets/windsingai/random_prompt/resolve/main/prompt_20W.zip

ç‰¹ç‚¹ï¼šçœŸå®å›¾ç‰‡åæ¨ï¼Œæ•°é‡å¤šï¼ŒäºŒæ¬¡å…ƒæµ“åº¦é«˜ï¼Œè¶³å¤Ÿæ³›åŒ–ï¼Œçº¦æœ‰20%çš„nsfw

å†…å®¹ï¼šé¢˜æå¾ˆå¤šï¼Œè€ƒè™‘åˆ°danbooruçš„æ„æˆï¼Œä¸»è¦è¿˜æ˜¯ä»¥å¥³æ€§ä¸ºä¸»

æ¥æºï¼šä» https://danbooru.donmai.us/ æ‰¹é‡çˆ¬å–ï¼Œä¿®æ”¹è‡ªæ æ å“¥çš„20Wè®­ç»ƒé›†

## ğŸ‰ å¿«é€Ÿä¸Šæ‰‹

### 1ï¸âƒ£ random_characetrs.py

éšæœº/æŒ‰é¡ºåºç”ŸæˆæŒ‡å®šè§’è‰²çš„å›¾ç‰‡

åŸç†ï¼Œä»jsonè¯»å–è§’è‰²åï¼Œç”Ÿæˆå›¾ç‰‡

æœ¬ä»“åº“å†…ç½®åŒ…æ‹¬åŸç¥ã€æ˜æ—¥æ–¹èˆŸã€fgoç­‰å¤šä¸ªä¸»æµæ¸¸æˆçš„éšæœºè§’è‰²åº“ã€‚

ä¾‹ï¼š
ä½¿ç”¨é€šè¿‡è¯»å–.\json\genshin.json æ–‡ä»¶ï¼Œå®ç°éšæœºåŸç¥è§’è‰²ç”Ÿæˆã€‚

jsonæ–‡ä»¶çš„ç»“æ„ï¼Œä»¥genshin.jsonä¸ºä¾‹ï¼š

```
{
  "role": [
    "noelle_(genshin_impact)",
    "faruzan_(genshin_impact)",
    "è§’è‰²1",
    "è§’è‰²2",
    "è§’è‰²3",
    .....
  ]
```

### 2ï¸âƒ£ random_prompt.py

è¯»å–éšæœºæç¤ºè¯åº“ï¼Œæ‰¹é‡ç”Ÿæˆéšæœºnai3å›¾ç‰‡

### 3ï¸âƒ£ nai3tagger.py

è¯»å–å›¾ç‰‡ä¿¡æ¯ï¼Œå¹¶ç”ŸæˆtxtåŒåæ–‡ä»¶

### 4ï¸âƒ£ clear.py

å»æ‰txtæ–‡ä»¶ä¸­çš„å‰ç¼€`prefix` ï¼Œç»‘å®šç”»é£

### 5ï¸âƒ£ UTF-8.py

å»æ‰txtæ–‡ä»¶ä¸­çš„éæ³•å­—ç¬¦ï¼Œæ¯”å¦‚ğŸ˜„ğŸ™ƒ

txtæ–‡ä»¶ä¸­çš„éƒ¨åˆ†éæ³•å­—ç¬¦ï¼Œå¯èƒ½ä¼šä»¤è®­ç»ƒå‘ç”ŸæŠ¥é”™ï¼Œè®­ç»ƒè„šæœ¬æ— æ³•è¯»å–txtï¼Œå› æ­¤ï¼Œå»æ‰éæ³•å­—ç¬¦æ˜¯å¿…éœ€çš„

### 6ï¸âƒ£ cut.py

å»æ‰å›¾ç‰‡ä¸­çš„æ°´å° ï¼ˆæµ‹è¯•åŠŸèƒ½ï¼‰


